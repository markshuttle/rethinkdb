name: rethinkdb
version: 2.3.5+next
summary: The open-source database for the real-time web
description: |
  RethinkDB is the first open-source, scalable JSON database built from the
  ground up for the realtime web. It inverts the traditional database
  architecture by exposing an exciting new access model – instead of polling
  for changes, the developer can tell RethinkDB to continuously push updated
  query results to applications in realtime. RethinkDB’s realtime push
  architecture dramatically reduces the time and effort necessary to build
  scalable realtime apps.

  In addition to being designed from the ground up for realtime apps,
  RethinkDB offers a flexible query language, intuitive operations and
  monitoring APIs, and is easy to setup and learn.
confinement: strict

apps:
  launch:
    daemon: forking
    command: bin/snap-launch.sh start
    stop-command: bin/snap-launch.sh stop
    plugs: [ network-bind, log-observe ]
  rethinkdb:
    command: bin/rethinkdb
    plugs: [ network-bind, log-observe ]

parts:
  rethink-db:
    plugin: autotools
    source: .
    configflags: [ "--allow-fetch" ]
    build-packages: [
      build-essential, protobuf-compiler, python, libprotobuf-dev,
      libcurl4-openssl-dev, libboost-all-dev, libncurses5-dev,
      wget, npm, m4]
    organize:
      usr/local/bin: bin
    filesets:
      binaries:
        - bin/*
        - scripts/snap-launch.sh
      libraries:
        - usr/lib/*
    snap:
      - $binaries
      - $libraries
    after: [ browserify, jemalloc ]
  browserify:
    plugin: nodejs
    node-packages: [ browserify@12.0.1 ]
  jemalloc:
    plugin: autotools
    source: git://github.com/jemalloc/jemalloc
    source-tag: 4.2.1
    build-packages: [ xsltproc, docbook-xsl ]


